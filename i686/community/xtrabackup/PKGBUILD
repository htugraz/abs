# $Id: PKGBUILD 122739 2014-11-19 13:57:55Z mtorromeo $
# Maintainer: Massimiliano Torromeo <massimiliano.torromeo@gmail.com>
# Contributor: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgname=xtrabackup
pkgver=2.2.6
pkgrel=1
pkgdesc='Non-blocking backup tool for MySQL'
arch=('i686' 'x86_64')
url='http://www.percona.com/software/percona-xtrabackup/'
license=('GPL')
depends=('libaio' 'libgcrypt' 'openssl' 'perl-dbd-mysql')
makedepends=('cmake' 'python-sphinx' 'zlib')
source=(http://www.percona.com/downloads/XtraBackup/LATEST/source/tarball/percona-xtrabackup-$pkgver.tar.gz)
sha256sums=('c5f42fbc406195e6de306b23a86f2d18283d3e086b9c1f4e8722635fd55e0b1d')

build() {
  cd percona-xtrabackup-$pkgver
  cmake -DBUILD_CONFIG=xtrabackup_release -DCMAKE_INSTALL_PREFIX=/usr
  make

  cd storage/innobase/xtrabackup/doc
  make man
}

package() {
  cd percona-xtrabackup-$pkgver
  make PREFIX=/usr DESTDIR="$pkgdir" install
  rm -rf "$pkgdir"/usr/xtrabackup-test

  cd storage/innobase/xtrabackup/doc/build/man
  for file in *.1; do
    install -Dm0644 $file "$pkgdir"/usr/share/man/man1/$file
  done
}
