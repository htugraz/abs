# $Id: PKGBUILD 202412 2013-12-21 17:49:24Z andrea $
# Maintainer: Andrea Scarpino <andrea@archlinux.org>

pkgbase=libdbusmenu-qt
pkgname=libdbusmenu-qt5
#pkgname=('libdbusmenu-qt4' 'libdbusmenu-qt5')
pkgver=r255
pkgrel=1
arch=('i686' 'x86_64')
url="https://launchpad.net/libdbusmenu-qt"
license=('GPL')
#makedepends=('cmake' 'doxygen' 'qjson' 'qt5-base')
makedepends=('cmake' 'doxygen' 'qt5-base' 'bzr')
source=("bzr+lp:${pkgbase}")
#source=("http://launchpad.net/${pkgname}/trunk/${pkgver}/+download/${pkgname}-${pkgver}.tar.bz2")
md5sums=('SKIP')

pkgver() {
  cd ${pkgbase}
  printf "r%s" "$(bzr revno)"
}

prepare() {
  mkdir build
  mkdir build-qt5
}

build() {
#  cd build
#  cmake ../${pkgbase} \
#    -DCMAKE_INSTALL_PREFIX=/usr \
#    -DCMAKE_BUILD_TYPE=Release \
#    -DCMAKE_INSTALL_LIBDIR=lib
#  make

  cd build-qt5
  cmake ../${pkgbase} \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_LIBDIR=lib \
    -DUSE_QT5=ON
  make
}

package_libdbusmenu-qt4() {
  pkgdesc='A library that provides a Qt4 implementation of the DBusMenu spec'
  depends=('qt4')
  provides=('libdbusmenu-qt')
  conflicts=('libdbusmenu-qt')
  replaces=('libdbusmenu-qt')

  cd build
  make DESTDIR="${pkgdir}" install
}

package_libdbusmenu-qt5() {
  pkgdesc='A library that provides a Qt5 implementation of the DBusMenu spec'
  depends=('qt5-base')

  cd build-qt5
  make DESTDIR="${pkgdir}" install
}
