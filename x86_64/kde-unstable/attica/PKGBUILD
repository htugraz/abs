# $Id: PKGBUILD 202281 2013-12-21 07:54:45Z andrea $
# Maintainer: Andrea Scarpino <andrea@archlinux.org>

pkgbase=attica
#pkgname=('attica-qt4' 'attica-qt5')
pkgname=('attica-qt5')
pkgver=v0.4.2.r14.ga84850f
pkgrel=1
arch=('i686' 'x86_64')
url='https://projects.kde.org/projects/kdesupport/attica'
license=('LGPL')
#makedepends=('extra-cmake-modules' 'qt4' 'qt5-base' 'git')
makedepends=('extra-cmake-modules' 'qt5-base' 'git')
source=("git://anongit.kde.org/${pkgbase}.git")
#source=("http://download.kde.org/stable/${pkgname}/${pkgname}-${pkgver}.tar.bz2")
md5sums=('SKIP')

pkgver() {
  cd ${pkgbase}
  git describe --long --tags | sed -E 's/([^-]*-g)/r\1/;s/-/./g'
}

prepare() {
  mkdir build
  mkdir build-qt5
}

build() {
#  cd build
#  cmake ../${pkgbase} \
#    -DCMAKE_BUILD_TYPE=Release \
#    -DCMAKE_INSTALL_PREFIX=/usr \
#    -DATTICA_ENABLE_TESTS=OFF \
#    -DQT4_BUILD=ON
#  make

  cd build-qt5
  cmake ../${pkgbase} \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/opt/kf5 \
    -DATTICA_ENABLE_TESTS=OFF \
    -DQT4_BUILD=OFF
  make
}

package_attica-qt4() {
  pkgdesc='A Qt4 library that implements the Open Collaboration Services API'
  depends=('qt4')
  provides=('attica')
  conflicts=('attica')
  replaces=('attica')

  cd build
  make DESTDIR="${pkgdir}" install
}

package_attica-qt5() {
  pkgdesc='A Qt5 library that implements the Open Collaboration Services API'
  depends=('qt5-base')

  cd build-qt5
  make DESTDIR="${pkgdir}" install
}
